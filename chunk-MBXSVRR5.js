import{g as M,i as u,j as P,k as d,m as x,o as R,p as g,q as v,r as m}from"./chunk-GCQTPIQW.js";import{N as O,S as E,c as w,l as c,m as A,oa as L,q as k}from"./chunk-REDDOPKR.js";import{a as l,b as I,f as C,g as D}from"./chunk-XXUG4HYI.js";var a=class{firestore=E(M);constructor(){}getResumesByUser(t){return new w(e=>{let i=()=>{};try{let s=u(this.firestore,"resumes"),n=g(s,m("userId","==",t));i=R(n,o=>{let p=o.docs.map(r=>l({id:r.id},r.data()));e.next(this.mapDates(p))},o=>{console.error("Firestore Error (getResumesByUser):",o),e.error(o)})}catch(s){console.error("Critical Setup Error:",s),e.error(s)}return()=>i()})}getResumeById(t){return new w(e=>{let i=()=>{};try{let s=d(this.firestore,`resumes/${t}`);i=R(s,n=>{n.exists()?e.next(this.mapDateSingle(l({id:n.id},n.data()))):(console.warn("[ResumeService] Doc does not exist!"),e.next(null))},n=>{console.error("Firestore Error (getResumeById):",n),e.error(n)})}catch(s){e.error(s)}return()=>i()})}searchResumes(t){let e=t.toLowerCase().trim();return e?c((async()=>{try{let i=u(this.firestore,"resumes"),s=g(i,m("isPublic","==",!0));return(await x(s)).docs.map(r=>this.mapDateSingle(l({id:r.id},r.data()))).filter(r=>{let f=r.personalInfo?.fullName?.toLowerCase().includes(e),h=r.title?.toLowerCase().includes(e),y=Array.isArray(r.skills)&&r.skills.some(b=>b.toLowerCase().includes(e));return f||h||y})}catch(i){console.warn("Search Index missing, falling back to client-side filter:",i);try{let s=u(this.firestore,"resumes"),n=g(s,m("isPublic","==",!0));return(await x(n)).docs.map(r=>this.mapDateSingle(l({id:r.id},r.data()))).filter(r=>{let f=r.personalInfo?.fullName?.toLowerCase().includes(e),h=r.title?.toLowerCase().includes(e),y=Array.isArray(r.skills)&&r.skills.some(b=>b.toLowerCase().includes(e));return f||h||y})}catch(s){return console.error("Critical Search Failure (Rules/Index):",s),[]}}})()):A([])}saveResume(t){let e=d(this.firestore,`resumes/${t.id}`),i=I(l({},t),{updatedAt:new Date().toISOString()});return c(v(e,i)).pipe(k(()=>({success:!0,id:t.id})))}deleteResume(t){let e=d(this.firestore,`resumes/${t}`);return c(P(e)).pipe(k(()=>({success:!0})))}mapDates(t){return t.map(e=>this.mapDateSingle(e))}mapDateSingle(t){return t.updatedAt&&typeof t.updatedAt.toDate=="function"&&(t.updatedAt=t.updatedAt.toDate()),t}};D(a,"\u0275fac",function(e){return new(e||a)}),D(a,"\u0275prov",O({token:a,factory:a.\u0275fac,providedIn:"root"})),a=C([L({providedIn:"root"})],a);export{a};
